# ğŸš€ Eufy GEO3 CI/CD è®¾ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è§ˆ

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä¸ºEufy GEO3é¡¹ç›®è®¾ç½®å®Œæ•´çš„æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²(CI/CD)æµç¨‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–GitHubåŒæ­¥å’Œéƒ¨ç½²æµç¨‹ã€‚

## ğŸ› ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬åœ°å¼€å‘ç¯å¢ƒ    â”‚ â”€â†’ â”‚   GitHubä»“åº“      â”‚ â”€â†’ â”‚   CI/CDæµæ°´çº¿    â”‚
â”‚                â”‚    â”‚                  â”‚    â”‚                â”‚
â”‚ â€¢ ä»£ç å¼€å‘       â”‚    â”‚ â€¢ ä»£ç å­˜å‚¨        â”‚    â”‚ â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•     â”‚
â”‚ â€¢ è‡ªåŠ¨åŒæ­¥       â”‚    â”‚ â€¢ ç‰ˆæœ¬æ§åˆ¶        â”‚    â”‚ â€¢ æ„å»ºéƒ¨ç½²       â”‚
â”‚ â€¢ æœ¬åœ°æµ‹è¯•       â”‚    â”‚ â€¢ Actionsæµç¨‹     â”‚    â”‚ â€¢ è´¨é‡æ£€æŸ¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### 1. åˆ›å»ºç¯å¢ƒæ–‡ä»¶

```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

### 2. é…ç½®GitHub Token

1. è®¿é—® [GitHub Personal Access Tokens](https://github.com/settings/tokens)
2. ç‚¹å‡» "Generate new token (classic)"
3. è®¾ç½®æƒé™ï¼š
   - âœ… `repo` (å®Œæ•´ä»“åº“è®¿é—®)
   - âœ… `workflow` (GitHub Actions)
   - âœ… `write:packages` (åŒ…å‘å¸ƒ)
4. å°†ç”Ÿæˆçš„tokenå¡«å…¥ `.env` æ–‡ä»¶

### 3. ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | æè¿° | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `GITHUB_TOKEN` | GitHubè®¿é—®ä»¤ç‰Œ | `ghp_xxxxxxxxxxxxx` |
| `GITHUB_REPO` | ä»“åº“URL | `https://github.com/user/repo.git` |
| `ENABLE_AUTO_SYNC` | å¯ç”¨è‡ªåŠ¨åŒæ­¥ | `true/false` |
| `ENABLE_CI_CD` | å¯ç”¨CI/CD | `true/false` |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ‰‹åŠ¨åŒæ­¥åˆ°GitHub

```bash
# åŸºæœ¬åŒæ­¥ï¼ˆä½¿ç”¨é»˜è®¤æäº¤æ¶ˆæ¯ï¼‰
./scripts/github-sync.sh

# è‡ªå®šä¹‰æäº¤æ¶ˆæ¯
./scripts/github-sync.sh "feat: æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—"

# å¼ºåˆ¶åŒæ­¥ï¼ˆè¦†ç›–è¿œç¨‹æ›´æ”¹ï¼‰
./scripts/github-sync.sh "fix: ä¿®å¤å…³é”®Bug" --force
```

### è‡ªåŠ¨åŒ–éƒ¨ç½²ç›‘æ§

```bash
# å¯åŠ¨æŒç»­ç›‘æ§æ¨¡å¼ï¼ˆæ¨èåœ¨å¼€å‘æ—¶ä½¿ç”¨ï¼‰
./scripts/auto-deploy.sh --monitor

# å•æ¬¡æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
./scripts/auto-deploy.sh --check

# å¼ºåˆ¶æ‰§è¡ŒåŒæ­¥
./scripts/auto-deploy.sh --force "Manual deployment"

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
./scripts/auto-deploy.sh --status
```

## ğŸ“Š CI/CDæµæ°´çº¿

### GitHub Actionså·¥ä½œæµ

æ¯æ¬¡æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ä»¥ä¸‹æµç¨‹ï¼š

1. **ä»£ç è´¨é‡æ£€æŸ¥**
   - ESLintä»£ç è§„èŒƒæ£€æŸ¥
   - TypeScriptç±»å‹æ£€æŸ¥
   - ä¾èµ–é¡¹å®‰å…¨æ‰«æ

2. **å‰ç«¯æµ‹è¯•ä¸æ„å»º**
   - å•å…ƒæµ‹è¯•æ‰§è¡Œ
   - Next.jsåº”ç”¨æ„å»º
   - æ„å»ºäº§ç‰©ä¸Šä¼ 

3. **åç«¯æµ‹è¯•**
   - åç«¯æœåŠ¡æµ‹è¯•
   - APIæ¥å£éªŒè¯
   - æœåŠ¡æ„å»ºæ£€æŸ¥

4. **ç«¯åˆ°ç«¯æµ‹è¯•**
   - Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•
   - å®Œæ•´ç”¨æˆ·æµç¨‹éªŒè¯
   - å±å¹•æˆªå›¾è®°å½•

5. **å®‰å…¨æ‰«æ**
   - npm auditå®‰å…¨æ£€æŸ¥
   - ä¾èµ–é¡¹æ¼æ´æ‰«æ
   - ä»£ç å®‰å…¨åˆ†æ

6. **éƒ¨ç½²å‡†å¤‡**
   - åˆ›å»ºéƒ¨ç½²åŒ…
   - ç”Ÿæˆéƒ¨ç½²ä¿¡æ¯
   - æ‰“åŒ…å‘å¸ƒäº§ç‰©

## ğŸ” ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—æ–‡ä»¶ä½ç½®

- **åŒæ­¥æ—¥å¿—**: `github-sync.log`
- **éƒ¨ç½²æ—¥å¿—**: `deploy.log`
- **åº”ç”¨æ—¥å¿—**: `/tmp/frontend-startup.log`

### å®æ—¶ç›‘æ§

```bash
# æŸ¥çœ‹åŒæ­¥æ—¥å¿—
tail -f github-sync.log

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
tail -f deploy.log

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
./scripts/auto-deploy.sh --status
```

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

- âœ… `.env` æ–‡ä»¶å·²åŠ å…¥ `.gitignore`
- âœ… GitHub tokenä½¿ç”¨ç¯å¢ƒå˜é‡
- âœ… æä¾› `.env.example` æ¨¡æ¿
- âŒ æ°¸è¿œä¸è¦æäº¤çœŸå®çš„token

### 2. è®¿é—®æ§åˆ¶

```bash
# è®¾ç½®è„šæœ¬æƒé™
chmod +x scripts/*.sh

# ä¿æŠ¤ç¯å¢ƒæ–‡ä»¶
chmod 600 .env
```

### 3. Tokenå®‰å…¨

- ğŸ”„ å®šæœŸæ›´æ–°GitHub token
- ğŸ”’ ä½¿ç”¨æœ€å°æƒé™åŸåˆ™
- ğŸ“± å¯ç”¨åŒå› ç´ è®¤è¯

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åŒæ­¥å¤±è´¥

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://github.com

# éªŒè¯tokenæƒé™
curl -H "Authorization: token $GITHUB_TOKEN" https://api.github.com/user

# é‡ç½®Gitå‡­æ®
git config --global --unset credential.helper
rm ~/.git-credentials
```

#### 2. æƒé™é—®é¢˜

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la scripts/

# é‡æ–°è®¾ç½®æƒé™
chmod +x scripts/*.sh
```

#### 3. ç¯å¢ƒå˜é‡æœªåŠ è½½

```bash
# æ£€æŸ¥ç¯å¢ƒæ–‡ä»¶
cat .env

# æ‰‹åŠ¨åŠ è½½ç¯å¢ƒå˜é‡
export $(cat .env | grep -v '^#' | xargs)
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export DEBUG=true
./scripts/github-sync.sh

# æŸ¥çœ‹GitçŠ¶æ€
git status
git log --oneline -10
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. åŒæ­¥ä¼˜åŒ–

- **å¢é‡åŒæ­¥**: åªåŒæ­¥å˜æ›´çš„æ–‡ä»¶
- **å¹¶è¡Œå¤„ç†**: å¤šä»»åŠ¡å¹¶å‘æ‰§è¡Œ
- **æ™ºèƒ½æ£€æµ‹**: é¿å…ä¸å¿…è¦çš„åŒæ­¥

### 2. ç›‘æ§ä¼˜åŒ–

```bash
# è°ƒæ•´ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰
export SYNC_INTERVAL=180  # 3åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡

# è‡ªå®šä¹‰ç›‘æ§ç›®å½•
export WATCH_DIRS="frontend backend"
```

## ğŸ”® é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰é’©å­

åˆ›å»º `scripts/hooks/` ç›®å½•æ·»åŠ è‡ªå®šä¹‰é’©å­ï¼š

```bash
# åŒæ­¥å‰é’©å­
scripts/hooks/pre-sync.sh

# åŒæ­¥åé’©å­
scripts/hooks/post-sync.sh
```

### 2. å¤šç¯å¢ƒæ”¯æŒ

```bash
# å¼€å‘ç¯å¢ƒ
./scripts/github-sync.sh --env development

# ç”Ÿäº§ç¯å¢ƒ
./scripts/github-sync.sh --env production
```

### 3. æ‰¹é‡æ“ä½œ

```bash
# æ‰¹é‡æäº¤å¤šä¸ªæ›´æ”¹
./scripts/batch-sync.sh "feat: æ‰¹é‡æ›´æ–°åŠŸèƒ½"
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Git å·¥ä½œæµæŒ‡å—](https://git-scm.com/book)
- [Playwright æµ‹è¯•æ–‡æ¡£](https://playwright.dev/)
- [Next.js éƒ¨ç½²æŒ‡å—](https://nextjs.org/docs/deployment)

## ğŸ†˜ æ”¯æŒä¸åé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼š

1. ğŸ“– æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. ğŸ” æ£€æŸ¥GitHub Actionsçš„æ‰§è¡Œæ—¥å¿—
3. ğŸ“ æŸ¥çœ‹é¡¹ç›®çš„issueè·Ÿè¸ªå™¨
4. ğŸ’¬ è”ç³»é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿ

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹æ£€æŸ¥æ¸…å•

- [ ] å¤åˆ¶ `.env.example` ä¸º `.env`
- [ ] é…ç½®GitHub tokenå’Œä»“åº“ä¿¡æ¯
- [ ] æµ‹è¯•æ‰‹åŠ¨åŒæ­¥: `./scripts/github-sync.sh`
- [ ] å¯åŠ¨è‡ªåŠ¨ç›‘æ§: `./scripts/auto-deploy.sh --monitor`
- [ ] éªŒè¯GitHub Actionså·¥ä½œæµ
- [ ] æ£€æŸ¥åº”ç”¨çŠ¶æ€: `./scripts/auto-deploy.sh --status`

---

*æœ€åæ›´æ–°: $(date '+%Y-%m-%d')*